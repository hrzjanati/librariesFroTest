{% load humanize %}
{% load rial_to_toman %}
{% if libraries %}
<div class="flex flex-col gap-6 max-w-7xl mx-auto px-4">

    {% for library in libraries %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <div class="bg-white rounded-lg shadow-md hover:shadow-lg transition p-6 border border-gray-200">
        <!-- Header Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ -->
        <div id="toast-container" class="fixed top-4 right-4 z-50"></div>
                  <h2 class="text-xl font-bold text-blue-700 mb-2 flex items-center gap-2">
                        <a href="{% url 'library_detail' library.id %}">
                            <span>Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ {{ library.name }}</span>
                            <i class="fas fa-map-marker-alt text-gray-800"></i>
                            <span>{{ library.province.name }}</span>
                        </a>
                  </h2>

        <p class="text-sm text-gray-500 mb-4">
            ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯: {{ library.date_of_year|date:"Y/m/d" }}
        </p>

        <!-- Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² -->
        <h3 class="font-semibold text-gray-800 mb-3">Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²:</h3>

        <!-- Ú©Ø§Ù†ØªÛŒÙ†Ø± Ù…Ø­Ø¯ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø§ÙÙ‚ÛŒ -->
        {% if library.required_items.all %}
        <div class="overflow-x-auto">
            <div class="flex gap-4 justify-start w-max px-2">
                {% for item in library.required_items.all %}
                <div class="flex-shrink-0 w-[250px]  <!-- Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª -->
                            bg-gray-50 p-4 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition
                            flex flex-col justify-between">
                    <h4 class="text-lg font-bold text-gray-800 mb-2">
                        {{ item.book.name|default:"Ù†Ø§Ù… Ú©ØªØ§Ø¨ Ù†Ø§Ù…Ø´Ø®Øµ" }}
                    </h4>
                    <p class="text-sm text-gray-600 mb-1">Ø¯Ø³ØªÙ‡: {{ item.book.category|default:"Ù†Ø§Ù…Ø´Ø®Øµ" }}</p>
                    <p class="text-sm text-gray-600 mb-1">ØªØ¹Ø¯Ø§Ø¯ Ù„Ø§Ø²Ù…: {{ item.number_of_required }}</p>
                    <p class="text-sm text-gray-600 mb-1">Ù…ÙˆØ¬ÙˆØ¯: {{ item.given_number }}</p>
                    <p class="text-sm font-semibold mt-2 text-gray-800">
                        Ù…Ø¨Ù„Øº: {{ item.amount|rial_to_toman }}
                    </p>

                            <!-- ğŸ”¥ Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… ØªÙ„Ú¯Ø±Ø§Ù… -->

                            <form
                                hx-post="{% url 'send_message' %}"
                                hx-target="#toast-container"
                                hx-swap="innerHTML"
                                class="inline-block">

                                {% csrf_token %}
                                <input type="hidden" name="book" value="{{ item.book.name }}">
                                <input type="hidden" name="library" value="{{ library.name }}">
                                <input type="hidden" name="number_of_required" value="{{ item.number_of_required }}">

                                <button type="submit" class="px-2 py-1 bg-blue-600 text-white rounded">
                                    Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø±Ø§ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…
                                </button>
                            </form>
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <p class="text-center text-gray-500 mt-2">Ù‡ÛŒÚ† Ú©ØªØ§Ø¨ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</p>
        {% endif %}

    </div>
    {% endfor %}

</div>
{% else %}
<p class="text-center font-bold text-gray-700">Ù‡ÛŒÚ† Ú©ØªØ§Ø¨ ÛŒØ§ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
{% endif %}

<!-- Pagination -->
{% if libraries.has_other_pages %}
<div class="flex justify-center mt-6 gap-2 flex-wrap">
    {% if libraries.has_previous %}
    <a hx-get="/?page={{ libraries.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if selected_provinces %}&provinces={{ selected_provinces|join:',' }}{% endif %}"
       hx-target="#librariesContainer"
       hx-swap="innerHTML"
       class="px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
        Ù‚Ø¨Ù„ÛŒ
    </a>
    {% endif %}

    <span class="px-3 py-1 font-semibold">{{ libraries.number }} / {{ libraries.paginator.num_pages }}</span>

    {% if libraries.has_next %}
    <a hx-get="/?page={{ libraries.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if selected_provinces %}&provinces={{ selected_provinces|join:',' }}{% endif %}"
       hx-target="#librariesContainer"
       hx-swap="innerHTML"
       class="px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
        Ø¨Ø¹Ø¯ÛŒ
    </a>
    {% endif %}
</div>
{% endif %}